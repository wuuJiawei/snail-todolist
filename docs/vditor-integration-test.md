# Vditor Markdown 编辑器集成测试文档

## 完成的功能

### 1. ✅ Vditor 依赖安装
- 已安装 `vditor` npm 包
- 已导入必要的样式文件

### 2. ✅ VditorEditor 组件
创建了全新的 VditorEditor 组件，位于 `src/components/tasks/VditorEditor.tsx`

**核心功能：**
- 使用 Vditor 的即时渲染（IR）模式，提供类似 Typora 的编辑体验
- 支持完整的 Markdown 语法
- 集成图片粘贴和上传功能
- 自动保存功能（通过 input 和 blur 事件）
- 任务切换时正确加载内容
- 支持只读模式（用于垃圾桶中的任务）

**工具栏配置：**
- Emoji 表情
- 标题（H1-H6）
- 文本格式：粗体、斜体、删除线
- 列表：无序列表、有序列表、任务列表
- 代码块和行内代码
- 链接和表格
- 撤销/重做
- 图片上传
- 编辑模式切换
- 全屏模式

### 3. ✅ TaskDetail 页面集成
- 将 `SimpleTaskEditor` 替换为 `VditorEditor`
- 优化附件系统显示位置（仅在有附件时显示，位于编辑器底部）
- 移除了标题框的图片粘贴功能（现在统一在编辑器中处理）
- 保持其他功能不变（标题编辑、日期选择、标签等）

### 4. ✅ 样式优化
在 `src/index.css` 中添加了 Vditor 相关样式：
- 主题适配（支持明暗模式）
- 工具栏样式统一
- 编辑器区域背景透明化
- 文本选择启用
- 响应式布局优化

## 需要测试的功能

### 基础功能测试
1. **编辑器初始化**
   - [ ] 打开任务详情时，编辑器正常加载
   - [ ] 编辑器工具栏显示正常
   - [ ] 占位符文本显示正确

2. **内容编辑**
   - [ ] 输入纯文本
   - [ ] 使用 Markdown 语法（标题、列表、粗体、斜体等）
   - [ ] 即时渲染效果正常
   - [ ] 中文输入法（IME）工作正常

3. **自动保存**
   - [ ] 输入内容后自动保存（约 800ms 延迟）
   - [ ] 编辑器失去焦点时保存
   - [ ] 刷新页面后内容保留

4. **任务切换**
   - [ ] 切换到另一个任务时，编辑器内容正确更新
   - [ ] 切换回原任务时，内容未丢失
   - [ ] 快速切换任务时不会出现内容混乱

5. **图片上传**
   - [ ] 粘贴图片（Ctrl/Cmd + V）自动上传
   - [ ] 拖拽图片到编辑器自动上传
   - [ ] 点击工具栏上传按钮选择图片
   - [ ] 上传成功后显示图片预览
   - [ ] 图片 Markdown 语法正确插入

6. **附件系统**
   - [ ] 上传的图片出现在附件列表
   - [ ] 附件列表仅在有附件时显示
   - [ ] 附件可以删除
   - [ ] 附件可以预览

7. **只读模式**
   - [ ] 垃圾桶中的任务编辑器为只读
   - [ ] 只读模式下工具栏禁用
   - [ ] 只读模式下仍可查看内容

8. **工具栏功能**
   - [ ] Emoji 选择器工作正常
   - [ ] 各种格式按钮功能正常
   - [ ] 撤销/重做功能正常
   - [ ] 全屏模式可以切换
   - [ ] 编辑模式（IR/WYSIWYG/SV）可以切换

9. **复制为 Markdown**
   - [ ] 右上角菜单中的"复制为 Markdown"功能正常
   - [ ] 复制的内容包含标题和正文
   - [ ] Markdown 格式正确

10. **响应式设计**
    - [ ] 在不同窗口大小下显示正常
    - [ ] 移动端适配（如果支持）

### 边界情况测试
1. **空内容**
   - [ ] 创建新任务时编辑器为空
   - [ ] 空任务可以正常保存

2. **大量内容**
   - [ ] 输入大量文本时性能正常
   - [ ] 滚动流畅

3. **特殊字符**
   - [ ] 支持各种 Unicode 字符
   - [ ] 支持代码块中的特殊字符
   - [ ] 支持表格中的特殊字符

4. **网络问题**
   - [ ] 图片上传失败时有错误提示
   - [ ] 保存失败时有错误提示

## 已知问题和改进建议

### 潜在问题
1. 需要测试在快速切换任务时是否会有内容闪烁
2. 需要确认在慢速网络下图片上传的用户体验
3. 需要测试长时间编辑是否会有性能问题

### 改进建议
1. 可以考虑添加更多工具栏选项（如图片大小调整）
2. 可以添加自定义快捷键配置
3. 可以添加导出为 PDF 功能
4. 可以添加协作编辑功能（如果支持多人协作）

## 迁移说明

### 从 SimpleTaskEditor 迁移到 VditorEditor

**数据兼容性：**
- SimpleTaskEditor 使用 Markdown 格式存储
- VditorEditor 也使用 Markdown 格式
- 数据格式完全兼容，无需迁移

**功能对比：**

| 功能 | SimpleTaskEditor | VditorEditor |
|-----|-----------------|--------------|
| Markdown 支持 | ✅ | ✅ |
| 即时预览 | ❌ | ✅ |
| 工具栏 | ❌ | ✅ |
| 图片上传 | ✅ | ✅ |
| 查找替换 | ✅ | ❌ (可以添加) |
| Emoji 支持 | ❌ | ✅ |
| 代码高亮 | ❌ | ✅ |
| 表格支持 | ❌ | ✅ |

**注意事项：**
- 查找替换功能暂时缺失，如果需要可以使用浏览器的查找功能（Ctrl/Cmd + F）
- Vditor 的全屏模式会覆盖整个窗口
- 工具栏会占用一些垂直空间

## 开发服务器

启动开发服务器进行测试：
```bash
npm run dev
```

然后访问 <http://localhost:5173>（或控制台显示的 URL）

## 反馈

如果发现任何问题，请记录：
1. 问题描述
2. 复现步骤
3. 预期行为
4. 实际行为
5. 浏览器和版本
6. 是否有控制台错误

---

集成完成时间: 2025-10-14
集成版本: Vditor 3.x

